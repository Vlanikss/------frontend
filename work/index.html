<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Таблица с графиками</title>
  <script src="https://code.highcharts.com/highcharts.js"></script>
 <link rel="stylesheet" href="./index.css">
</head>
<body>

  <h2>Таблица показателей</h2>
  
  <table>
    <thead>
      <tr>
        <th>Показатель</th>
        <th>Текущий день</th>
        <th>Вчера</th>
        <th>Этот день недели</th>
      </tr>
    </thead>
    <tbody>
      <tr id="row-revenue" onclick="showChart('revenue', 50000, 48000, 52000)">
        <td>Выручка</td>
        <td>50000</td>
        <td>48000</td>
        <td>52000</td>
      </tr>
      <tr id="row-cash" onclick="showChart('cash', 20000, 18000, 21000)">
        <td>Наличные</td>
        <td>20000</td>
        <td>18000</td>
        <td>21000</td>
      </tr>
      <tr id="row-card_pay" onclick="showChart('card_pay', 15000, 14000, 16000)">
        <td>Безналичный расчет</td>
        <td>15000</td>
        <td>14000</td>
        <td>16000</td>
      </tr>
      <tr id="row-credit_cards" onclick="showChart('credit_cards', 10000, 9000, 11000)">
        <td>Кредитные карты</td>
        <td>10000</td>
        <td>9000</td>
        <td>11000</td>
      </tr>
      <tr id="row-avg_check" onclick="showChart('avg_check', 500, 480, 510)">
        <td>Средний чек</td>
        <td>500</td>
        <td>480</td>
        <td>510</td>
      </tr>
      <tr id="row-avg_guest" onclick="showChart('avg_guest', 30, 28, 32)">
        <td>Средний гость</td>
        <td>30</td>
        <td>28</td>
        <td>32</td>
      </tr>
      <tr id="row-check_remov_after" onclick="showChart('check_remov_after', 1000, 900, 1200)">
        <td>Удаление из чека (после оплаты)</td>
        <td>1000</td>
        <td>900</td>
        <td>1200</td>
      </tr>
      <tr id="row-check_remov_before" onclick="showChart('check_remov_before', 500, 450, 550)">
        <td>Удаление из чека (до оплаты)</td>
        <td>500</td>
        <td>450</td>
        <td>550</td>
      </tr>
      <tr id="row-check_count" onclick="showChart('check_count', 100, 95, 105)">
        <td>Количество чеков</td>
        <td>100</td>
        <td>95</td>
        <td>105</td>
      </tr>
      <tr id="row-guest_count" onclick="showChart('guest_count', 150, 140, 160)">
        <td>Количество гостей</td>
        <td>150</td>
        <td>140</td>
        <td>160</td>
      </tr>
    </tbody>
  </table>

  <div id="chartContainer"></div>

  <script>
    
    function calculatePercentChange(currentDay, yesterday) {
      return ((currentDay - yesterday) / yesterday * 100).toFixed(2);
    }

   
    function showChart(indicator, currentDay, yesterday, dayOfWeek) {
     
      const percentChange = calculatePercentChange(currentDay, yesterday);
      
     
      const row = document.getElementById('row-' + indicator);
      const tdV = row.cells[2];
      tdV.innerHTML = `${yesterday} (${percentChange}%)`;

      let data;
      let title;

      switch(indicator) {
        case 'revenue':
          data = [currentDay, yesterday, dayOfWeek];
          title = 'Выручка';
          break;
        case 'cash':
          data = [currentDay, yesterday, dayOfWeek];
          title = 'Наличные';
          break;
        case 'card_pay':
          data = [currentDay, yesterday, dayOfWeek];
          title = 'Безналичный расчет';
          break;
        case 'credit_cards':
          data = [currentDay, yesterday, dayOfWeek];
          title = 'Кредитные карты';
          break;
        case 'avg_check':
          data = [currentDay, yesterday, dayOfWeek];
          title = 'Средний чек';
          break;
        case 'avg_guest':
          data = [currentDay, yesterday, dayOfWeek];
          title = 'Средний гость';
          break;
        case 'check_remov_after':
          data = [currentDay, yesterday, dayOfWeek];
          title = 'Удаление из чека (после оплаты)';
          break;
        case 'check_remov_before':
          data = [currentDay, yesterday, dayOfWeek];
          title = 'Удаление из чека (до оплаты)';
          break;
        case 'check_count':
          data = [currentDay, yesterday, dayOfWeek];
          title = 'Количество чеков';
          break;
        case 'guest_count':
          data = [currentDay, yesterday, dayOfWeek];
          title = 'Количество гостей';
          break;
      }

      Highcharts.chart('chartContainer', {
        chart: {
          type: 'line'
        },
        title: {
          text: title
        },
        xAxis: {
          categories: ['Текущий день', 'Вчера', 'Этот день недели']
        },
        yAxis: {
          title: {
            text: 'Значения'
          }
        },
        series: [{
          name: title,
          data: data
        }]
      });
    }

    
    document.addEventListener("DOMContentLoaded", function() {
      const rows = document.querySelectorAll('tr');
      rows.forEach(row => {
        const tdCurrent = parseFloat(row.cells[1]?.innerText);
        const tdYesterday = parseFloat(row.cells[2]?.innerText);
        if ((tdCurrent) && (tdYesterday)) {
          const percentChange = calculatePercentChange(tdCurrent, tdYesterday);
          const tdV = row.cells[2];
          tdV.innerHTML = `${tdYesterday} (${percentChange}%)`;
        }
      });
    });
  </script>

</body>
</html>
